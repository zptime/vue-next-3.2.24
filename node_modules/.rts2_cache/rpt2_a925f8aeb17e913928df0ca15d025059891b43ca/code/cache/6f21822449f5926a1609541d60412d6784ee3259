{"code":"import { getCurrentInstance } from '../component';\r\nimport { resolveInjections } from '../componentOptions';\r\nimport { getCompatListeners } from './instanceListeners';\r\nimport { compatH } from './renderFn';\r\nconst normalizedFunctionalComponentMap = new Map();\r\nexport const legacySlotProxyHandlers = {\r\n    get(target, key) {\r\n        const slot = target[key];\r\n        return slot && slot();\r\n    }\r\n};\r\nexport function convertLegacyFunctionalComponent(comp) {\r\n    if (normalizedFunctionalComponentMap.has(comp)) {\r\n        return normalizedFunctionalComponentMap.get(comp);\r\n    }\r\n    const legacyFn = comp.render;\r\n    const Func = (props, ctx) => {\r\n        const instance = getCurrentInstance();\r\n        const legacyCtx = {\r\n            props,\r\n            children: instance.vnode.children || [],\r\n            data: instance.vnode.props || {},\r\n            scopedSlots: ctx.slots,\r\n            parent: instance.parent && instance.parent.proxy,\r\n            slots() {\r\n                return new Proxy(ctx.slots, legacySlotProxyHandlers);\r\n            },\r\n            get listeners() {\r\n                return getCompatListeners(instance);\r\n            },\r\n            get injections() {\r\n                if (comp.inject) {\r\n                    const injections = {};\r\n                    resolveInjections(comp.inject, injections);\r\n                    return injections;\r\n                }\r\n                return {};\r\n            }\r\n        };\r\n        return legacyFn(compatH, legacyCtx);\r\n    };\r\n    Func.props = comp.props;\r\n    Func.displayName = comp.name;\r\n    Func.compatConfig = comp.compatConfig;\r\n    // v2 functional components do not inherit attrs\r\n    Func.inheritAttrs = false;\r\n    normalizedFunctionalComponentMap.set(comp, Func);\r\n    return Func;\r\n}\r\n","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/component.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/componentOptions.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/componentSlots.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/compat/instanceListeners.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/compat/renderFn.ts"]}
