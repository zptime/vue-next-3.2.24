{"code":"import { isArray, isObject, isPromise } from '@vue/shared';\r\nimport { defineAsyncComponent } from '../apiAsyncComponent';\r\nimport { isVNode } from '../vnode';\r\nconst normalizedAsyncComponentMap = new Map();\r\nexport function convertLegacyAsyncComponent(comp) {\r\n    if (normalizedAsyncComponentMap.has(comp)) {\r\n        return normalizedAsyncComponentMap.get(comp);\r\n    }\r\n    // we have to call the function here due to how v2's API won't expose the\r\n    // options until we call it\r\n    let resolve;\r\n    let reject;\r\n    const fallbackPromise = new Promise((r, rj) => {\r\n        ;\r\n        (resolve = r), (reject = rj);\r\n    });\r\n    const res = comp(resolve, reject);\r\n    let converted;\r\n    if (isPromise(res)) {\r\n        converted = defineAsyncComponent(() => res);\r\n    }\r\n    else if (isObject(res) && !isVNode(res) && !isArray(res)) {\r\n        converted = defineAsyncComponent({\r\n            loader: () => res.component,\r\n            loadingComponent: res.loading,\r\n            errorComponent: res.error,\r\n            delay: res.delay,\r\n            timeout: res.timeout\r\n        });\r\n    }\r\n    else if (res == null) {\r\n        converted = defineAsyncComponent(() => fallbackPromise);\r\n    }\r\n    else {\r\n        converted = comp; // probably a v3 functional comp\r\n    }\r\n    normalizedAsyncComponentMap.set(comp, converted);\r\n    return converted;\r\n}\r\n","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/shared/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/apiAsyncComponent.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/component.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/vnode.ts"]}
