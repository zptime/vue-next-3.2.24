{"code":"import { reactive, readonly, toRaw, readonlyMap, reactiveMap, shallowReactiveMap, shallowReadonlyMap, isReadonly } from './reactive';\r\nimport { track, trigger, ITERATE_KEY, pauseTracking, resetTracking } from './effect';\r\nimport { isObject, hasOwn, isSymbol, hasChanged, isArray, isIntegerKey, extend, makeMap } from '@vue/shared';\r\nimport { isRef } from './ref';\r\nconst isNonTrackableKeys = /*#__PURE__*/ makeMap(`__proto__,__v_isRef,__isVue`);\r\nconst builtInSymbols = new Set(Object.getOwnPropertyNames(Symbol)\r\n    .map(key => Symbol[key])\r\n    .filter(isSymbol));\r\nconst get = /*#__PURE__*/ createGetter();\r\nconst shallowGet = /*#__PURE__*/ createGetter(false, true);\r\nconst readonlyGet = /*#__PURE__*/ createGetter(true);\r\nconst shallowReadonlyGet = /*#__PURE__*/ createGetter(true, true);\r\nconst arrayInstrumentations = /*#__PURE__*/ createArrayInstrumentations();\r\nfunction createArrayInstrumentations() {\r\n    const instrumentations = {};\r\n    ['includes', 'indexOf', 'lastIndexOf'].forEach(key => {\r\n        instrumentations[key] = function (...args) {\r\n            const arr = toRaw(this);\r\n            for (let i = 0, l = this.length; i < l; i++) {\r\n                track(arr, \"get\" /* GET */, i + '');\r\n            }\r\n            // we run the method using the original args first (which may be reactive)\r\n            const res = arr[key](...args);\r\n            if (res === -1 || res === false) {\r\n                // if that didn't work, run it again using raw values.\r\n                return arr[key](...args.map(toRaw));\r\n            }\r\n            else {\r\n                return res;\r\n            }\r\n        };\r\n    });\r\n    ['push', 'pop', 'shift', 'unshift', 'splice'].forEach(key => {\r\n        instrumentations[key] = function (...args) {\r\n            pauseTracking();\r\n            const res = toRaw(this)[key].apply(this, args);\r\n            resetTracking();\r\n            return res;\r\n        };\r\n    });\r\n    return instrumentations;\r\n}\r\nfunction createGetter(isReadonly = false, shallow = false) {\r\n    return function get(target, key, receiver) {\r\n        if (key === \"__v_isReactive\" /* IS_REACTIVE */) {\r\n            return !isReadonly;\r\n        }\r\n        else if (key === \"__v_isReadonly\" /* IS_READONLY */) {\r\n            return isReadonly;\r\n        }\r\n        else if (key === \"__v_raw\" /* RAW */ &&\r\n            receiver ===\r\n                (isReadonly\r\n                    ? shallow\r\n                        ? shallowReadonlyMap\r\n                        : readonlyMap\r\n                    : shallow\r\n                        ? shallowReactiveMap\r\n                        : reactiveMap).get(target)) {\r\n            return target;\r\n        }\r\n        const targetIsArray = isArray(target);\r\n        if (!isReadonly && targetIsArray && hasOwn(arrayInstrumentations, key)) {\r\n            return Reflect.get(arrayInstrumentations, key, receiver);\r\n        }\r\n        const res = Reflect.get(target, key, receiver);\r\n        if (isSymbol(key) ? builtInSymbols.has(key) : isNonTrackableKeys(key)) {\r\n            return res;\r\n        }\r\n        if (!isReadonly) {\r\n            track(target, \"get\" /* GET */, key);\r\n        }\r\n        if (shallow) {\r\n            return res;\r\n        }\r\n        if (isRef(res)) {\r\n            // ref unwrapping - does not apply for Array + integer key.\r\n            const shouldUnwrap = !targetIsArray || !isIntegerKey(key);\r\n            return shouldUnwrap ? res.value : res;\r\n        }\r\n        if (isObject(res)) {\r\n            // Convert returned value into a proxy as well. we do the isObject check\r\n            // here to avoid invalid value warning. Also need to lazy access readonly\r\n            // and reactive here to avoid circular dependency.\r\n            return isReadonly ? readonly(res) : reactive(res);\r\n        }\r\n        return res;\r\n    };\r\n}\r\nconst set = /*#__PURE__*/ createSetter();\r\nconst shallowSet = /*#__PURE__*/ createSetter(true);\r\nfunction createSetter(shallow = false) {\r\n    return function set(target, key, value, receiver) {\r\n        let oldValue = target[key];\r\n        if (!shallow && !isReadonly(value)) {\r\n            value = toRaw(value);\r\n            oldValue = toRaw(oldValue);\r\n            if (!isArray(target) && isRef(oldValue) && !isRef(value)) {\r\n                oldValue.value = value;\r\n                return true;\r\n            }\r\n        }\r\n        else {\r\n            // in shallow mode, objects are set as-is regardless of reactive or not\r\n        }\r\n        const hadKey = isArray(target) && isIntegerKey(key)\r\n            ? Number(key) < target.length\r\n            : hasOwn(target, key);\r\n        const result = Reflect.set(target, key, value, receiver);\r\n        // don't trigger if target is something up in the prototype chain of original\r\n        if (target === toRaw(receiver)) {\r\n            if (!hadKey) {\r\n                trigger(target, \"add\" /* ADD */, key, value);\r\n            }\r\n            else if (hasChanged(value, oldValue)) {\r\n                trigger(target, \"set\" /* SET */, key, value, oldValue);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n}\r\nfunction deleteProperty(target, key) {\r\n    const hadKey = hasOwn(target, key);\r\n    const oldValue = target[key];\r\n    const result = Reflect.deleteProperty(target, key);\r\n    if (result && hadKey) {\r\n        trigger(target, \"delete\" /* DELETE */, key, undefined, oldValue);\r\n    }\r\n    return result;\r\n}\r\nfunction has(target, key) {\r\n    const result = Reflect.has(target, key);\r\n    if (!isSymbol(key) || !builtInSymbols.has(key)) {\r\n        track(target, \"has\" /* HAS */, key);\r\n    }\r\n    return result;\r\n}\r\nfunction ownKeys(target) {\r\n    track(target, \"iterate\" /* ITERATE */, isArray(target) ? 'length' : ITERATE_KEY);\r\n    return Reflect.ownKeys(target);\r\n}\r\nexport const mutableHandlers = {\r\n    get,\r\n    set,\r\n    deleteProperty,\r\n    has,\r\n    ownKeys\r\n};\r\nexport const readonlyHandlers = {\r\n    get: readonlyGet,\r\n    set(target, key) {\r\n        if (__DEV__) {\r\n            console.warn(`Set operation on key \"${String(key)}\" failed: target is readonly.`, target);\r\n        }\r\n        return true;\r\n    },\r\n    deleteProperty(target, key) {\r\n        if (__DEV__) {\r\n            console.warn(`Delete operation on key \"${String(key)}\" failed: target is readonly.`, target);\r\n        }\r\n        return true;\r\n    }\r\n};\r\nexport const shallowReactiveHandlers = /*#__PURE__*/ extend({}, mutableHandlers, {\r\n    get: shallowGet,\r\n    set: shallowSet\r\n});\r\n// Props handlers are special in the sense that it should not unwrap top-level\r\n// refs (in order to allow refs to be explicitly passed down), but should\r\n// retain the reactivity of the normal readonly object.\r\nexport const shallowReadonlyHandlers = /*#__PURE__*/ extend({}, readonlyHandlers, {\r\n    get: shallowReadonlyGet\r\n});\r\n//# sourceMappingURL=baseHandlers.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/reactive.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/operations.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/effect.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/shared/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/ref.ts"],"map":"{\"version\":3,\"file\":\"baseHandlers.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/reactivity/src/baseHandlers.ts\"],\"names\":[],\"mappings\":\"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\"}"}
