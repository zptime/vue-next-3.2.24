{"code":"import { isArray } from '@vue/shared';\r\nimport { callWithAsyncErrorHandling } from '../errorHandling';\r\nimport { assertCompatEnabled } from './compatConfig';\r\nconst eventRegistryMap = /*#__PURE__*/ new WeakMap();\r\nexport function getRegistry(instance) {\r\n    let events = eventRegistryMap.get(instance);\r\n    if (!events) {\r\n        eventRegistryMap.set(instance, (events = Object.create(null)));\r\n    }\r\n    return events;\r\n}\r\nexport function on(instance, event, fn) {\r\n    if (isArray(event)) {\r\n        event.forEach(e => on(instance, e, fn));\r\n    }\r\n    else {\r\n        if (event.startsWith('hook:')) {\r\n            assertCompatEnabled(\"INSTANCE_EVENT_HOOKS\" /* INSTANCE_EVENT_HOOKS */, instance, event);\r\n        }\r\n        else {\r\n            assertCompatEnabled(\"INSTANCE_EVENT_EMITTER\" /* INSTANCE_EVENT_EMITTER */, instance);\r\n        }\r\n        const events = getRegistry(instance);\r\n        (events[event] || (events[event] = [])).push(fn);\r\n    }\r\n    return instance.proxy;\r\n}\r\nexport function once(instance, event, fn) {\r\n    const wrapped = (...args) => {\r\n        off(instance, event, wrapped);\r\n        fn.call(instance.proxy, ...args);\r\n    };\r\n    wrapped.fn = fn;\r\n    on(instance, event, wrapped);\r\n    return instance.proxy;\r\n}\r\nexport function off(instance, event, fn) {\r\n    assertCompatEnabled(\"INSTANCE_EVENT_EMITTER\" /* INSTANCE_EVENT_EMITTER */, instance);\r\n    const vm = instance.proxy;\r\n    // all\r\n    if (!event) {\r\n        eventRegistryMap.set(instance, Object.create(null));\r\n        return vm;\r\n    }\r\n    // array of events\r\n    if (isArray(event)) {\r\n        event.forEach(e => off(instance, e, fn));\r\n        return vm;\r\n    }\r\n    // specific event\r\n    const events = getRegistry(instance);\r\n    const cbs = events[event];\r\n    if (!cbs) {\r\n        return vm;\r\n    }\r\n    if (!fn) {\r\n        events[event] = undefined;\r\n        return vm;\r\n    }\r\n    events[event] = cbs.filter(cb => !(cb === fn || cb.fn === fn));\r\n    return vm;\r\n}\r\nexport function emit(instance, event, args) {\r\n    const cbs = getRegistry(instance)[event];\r\n    if (cbs) {\r\n        callWithAsyncErrorHandling(cbs.map(cb => cb.bind(instance.proxy)), instance, 6 /* COMPONENT_EVENT_HANDLER */, args);\r\n    }\r\n    return instance.proxy;\r\n}\r\n//# sourceMappingURL=instanceEventEmitter.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/shared/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/component.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/errorHandling.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/compat/compatConfig.ts"],"map":"{\"version\":3,\"file\":\"instanceEventEmitter.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../packages/runtime-core/src/compat/instanceEventEmitter.ts\"],\"names\":[],\"mappings\":\"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\"}"}
