{"code":"import { transformOn as baseTransform, createObjectProperty, createCallExpression, createSimpleExpression, createCompoundExpression, isStaticExp, checkCompatEnabled } from '@vue/compiler-core';\r\nimport { V_ON_WITH_MODIFIERS, V_ON_WITH_KEYS } from '../runtimeHelpers';\r\nimport { makeMap, capitalize } from '@vue/shared';\r\nconst isEventOptionModifier = /*#__PURE__*/ makeMap(`passive,once,capture`);\r\nconst isNonKeyModifier = /*#__PURE__*/ makeMap(\r\n// event propagation management\r\n`stop,prevent,self,` +\r\n    // system modifiers + exact\r\n    `ctrl,shift,alt,meta,exact,` +\r\n    // mouse\r\n    `middle`);\r\n// left & right could be mouse or key modifiers based on event type\r\nconst maybeKeyModifier = /*#__PURE__*/ makeMap('left,right');\r\nconst isKeyboardEvent = /*#__PURE__*/ makeMap(`onkeyup,onkeydown,onkeypress`, true);\r\nconst resolveModifiers = (key, modifiers, context, loc) => {\r\n    const keyModifiers = [];\r\n    const nonKeyModifiers = [];\r\n    const eventOptionModifiers = [];\r\n    for (let i = 0; i < modifiers.length; i++) {\r\n        const modifier = modifiers[i];\r\n        if (__COMPAT__ &&\r\n            modifier === 'native' &&\r\n            checkCompatEnabled(\"COMPILER_V_ON_NATIVE\" /* COMPILER_V_ON_NATIVE */, context, loc)) {\r\n            eventOptionModifiers.push(modifier);\r\n        }\r\n        else if (isEventOptionModifier(modifier)) {\r\n            // eventOptionModifiers: modifiers for addEventListener() options,\r\n            // e.g. .passive & .capture\r\n            eventOptionModifiers.push(modifier);\r\n        }\r\n        else {\r\n            // runtimeModifiers: modifiers that needs runtime guards\r\n            if (maybeKeyModifier(modifier)) {\r\n                if (isStaticExp(key)) {\r\n                    if (isKeyboardEvent(key.content)) {\r\n                        keyModifiers.push(modifier);\r\n                    }\r\n                    else {\r\n                        nonKeyModifiers.push(modifier);\r\n                    }\r\n                }\r\n                else {\r\n                    keyModifiers.push(modifier);\r\n                    nonKeyModifiers.push(modifier);\r\n                }\r\n            }\r\n            else {\r\n                if (isNonKeyModifier(modifier)) {\r\n                    nonKeyModifiers.push(modifier);\r\n                }\r\n                else {\r\n                    keyModifiers.push(modifier);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return {\r\n        keyModifiers,\r\n        nonKeyModifiers,\r\n        eventOptionModifiers\r\n    };\r\n};\r\nconst transformClick = (key, event) => {\r\n    const isStaticClick = isStaticExp(key) && key.content.toLowerCase() === 'onclick';\r\n    return isStaticClick\r\n        ? createSimpleExpression(event, true)\r\n        : key.type !== 4 /* SIMPLE_EXPRESSION */\r\n            ? createCompoundExpression([\r\n                `(`,\r\n                key,\r\n                `) === \"onClick\" ? \"${event}\" : (`,\r\n                key,\r\n                `)`\r\n            ])\r\n            : key;\r\n};\r\nexport const transformOn = (dir, node, context) => {\r\n    return baseTransform(dir, node, context, baseResult => {\r\n        const { modifiers } = dir;\r\n        if (!modifiers.length)\r\n            return baseResult;\r\n        let { key, value: handlerExp } = baseResult.props[0];\r\n        const { keyModifiers, nonKeyModifiers, eventOptionModifiers } = resolveModifiers(key, modifiers, context, dir.loc);\r\n        // normalize click.right and click.middle since they don't actually fire\r\n        if (nonKeyModifiers.includes('right')) {\r\n            key = transformClick(key, `onContextmenu`);\r\n        }\r\n        if (nonKeyModifiers.includes('middle')) {\r\n            key = transformClick(key, `onMouseup`);\r\n        }\r\n        if (nonKeyModifiers.length) {\r\n            handlerExp = createCallExpression(context.helper(V_ON_WITH_MODIFIERS), [\r\n                handlerExp,\r\n                JSON.stringify(nonKeyModifiers)\r\n            ]);\r\n        }\r\n        if (keyModifiers.length &&\r\n            // if event name is dynamic, always wrap with keys guard\r\n            (!isStaticExp(key) || isKeyboardEvent(key.content))) {\r\n            handlerExp = createCallExpression(context.helper(V_ON_WITH_KEYS), [\r\n                handlerExp,\r\n                JSON.stringify(keyModifiers)\r\n            ]);\r\n        }\r\n        if (eventOptionModifiers.length) {\r\n            const modifierPostfix = eventOptionModifiers.map(capitalize).join('');\r\n            key = isStaticExp(key)\r\n                ? createSimpleExpression(`${key.content}${modifierPostfix}`, true)\r\n                : createCompoundExpression([`(`, key, `) + \"${modifierPostfix}\"`]);\r\n        }\r\n        return {\r\n            props: [createObjectProperty(key, handlerExp)]\r\n        };\r\n    });\r\n};\r\n//# sourceMappingURL=vOn.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-core/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-dom/src/runtimeHelpers.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/shared/src/index.ts"],"map":"{\"version\":3,\"file\":\"vOn.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../packages/compiler-dom/src/transforms/vOn.ts\"],\"names\":[],\"mappings\":\"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\"}"}
