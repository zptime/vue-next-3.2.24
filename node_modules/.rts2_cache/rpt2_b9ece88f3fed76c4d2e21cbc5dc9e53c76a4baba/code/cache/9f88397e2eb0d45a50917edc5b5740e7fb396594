{"code":"import { RESOLVE_FILTER } from '../runtimeHelpers';\r\nimport { toValidAssetId } from '@vue/compiler-core';\r\nimport { isCompatEnabled, warnDeprecation } from './compatConfig';\r\nconst validDivisionCharRE = /[\\w).+\\-_$\\]]/;\r\nexport const transformFilter = (node, context) => {\r\n    if (!isCompatEnabled(\"COMPILER_FILTER\" /* COMPILER_FILTERS */, context)) {\r\n        return;\r\n    }\r\n    if (node.type === 5 /* INTERPOLATION */) {\r\n        // filter rewrite is applied before expression transform so only\r\n        // simple expressions are possible at this stage\r\n        rewriteFilter(node.content, context);\r\n    }\r\n    if (node.type === 1 /* ELEMENT */) {\r\n        node.props.forEach((prop) => {\r\n            if (prop.type === 7 /* DIRECTIVE */ &&\r\n                prop.name !== 'for' &&\r\n                prop.exp) {\r\n                rewriteFilter(prop.exp, context);\r\n            }\r\n        });\r\n    }\r\n};\r\nfunction rewriteFilter(node, context) {\r\n    if (node.type === 4 /* SIMPLE_EXPRESSION */) {\r\n        parseFilter(node, context);\r\n    }\r\n    else {\r\n        for (let i = 0; i < node.children.length; i++) {\r\n            const child = node.children[i];\r\n            if (typeof child !== 'object')\r\n                continue;\r\n            if (child.type === 4 /* SIMPLE_EXPRESSION */) {\r\n                parseFilter(child, context);\r\n            }\r\n            else if (child.type === 8 /* COMPOUND_EXPRESSION */) {\r\n                rewriteFilter(node, context);\r\n            }\r\n            else if (child.type === 5 /* INTERPOLATION */) {\r\n                rewriteFilter(child.content, context);\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction parseFilter(node, context) {\r\n    const exp = node.content;\r\n    let inSingle = false;\r\n    let inDouble = false;\r\n    let inTemplateString = false;\r\n    let inRegex = false;\r\n    let curly = 0;\r\n    let square = 0;\r\n    let paren = 0;\r\n    let lastFilterIndex = 0;\r\n    let c, prev, i, expression, filters = [];\r\n    for (i = 0; i < exp.length; i++) {\r\n        prev = c;\r\n        c = exp.charCodeAt(i);\r\n        if (inSingle) {\r\n            if (c === 0x27 && prev !== 0x5c)\r\n                inSingle = false;\r\n        }\r\n        else if (inDouble) {\r\n            if (c === 0x22 && prev !== 0x5c)\r\n                inDouble = false;\r\n        }\r\n        else if (inTemplateString) {\r\n            if (c === 0x60 && prev !== 0x5c)\r\n                inTemplateString = false;\r\n        }\r\n        else if (inRegex) {\r\n            if (c === 0x2f && prev !== 0x5c)\r\n                inRegex = false;\r\n        }\r\n        else if (c === 0x7c && // pipe\r\n            exp.charCodeAt(i + 1) !== 0x7c &&\r\n            exp.charCodeAt(i - 1) !== 0x7c &&\r\n            !curly &&\r\n            !square &&\r\n            !paren) {\r\n            if (expression === undefined) {\r\n                // first filter, end of expression\r\n                lastFilterIndex = i + 1;\r\n                expression = exp.slice(0, i).trim();\r\n            }\r\n            else {\r\n                pushFilter();\r\n            }\r\n        }\r\n        else {\r\n            switch (c) {\r\n                case 0x22:\r\n                    inDouble = true;\r\n                    break; // \"\r\n                case 0x27:\r\n                    inSingle = true;\r\n                    break; // '\r\n                case 0x60:\r\n                    inTemplateString = true;\r\n                    break; // `\r\n                case 0x28:\r\n                    paren++;\r\n                    break; // (\r\n                case 0x29:\r\n                    paren--;\r\n                    break; // )\r\n                case 0x5b:\r\n                    square++;\r\n                    break; // [\r\n                case 0x5d:\r\n                    square--;\r\n                    break; // ]\r\n                case 0x7b:\r\n                    curly++;\r\n                    break; // {\r\n                case 0x7d:\r\n                    curly--;\r\n                    break; // }\r\n            }\r\n            if (c === 0x2f) {\r\n                // /\r\n                let j = i - 1;\r\n                let p;\r\n                // find first non-whitespace prev char\r\n                for (; j >= 0; j--) {\r\n                    p = exp.charAt(j);\r\n                    if (p !== ' ')\r\n                        break;\r\n                }\r\n                if (!p || !validDivisionCharRE.test(p)) {\r\n                    inRegex = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    if (expression === undefined) {\r\n        expression = exp.slice(0, i).trim();\r\n    }\r\n    else if (lastFilterIndex !== 0) {\r\n        pushFilter();\r\n    }\r\n    function pushFilter() {\r\n        filters.push(exp.slice(lastFilterIndex, i).trim());\r\n        lastFilterIndex = i + 1;\r\n    }\r\n    if (filters.length) {\r\n        __DEV__ &&\r\n            warnDeprecation(\"COMPILER_FILTER\" /* COMPILER_FILTERS */, context, node.loc);\r\n        for (i = 0; i < filters.length; i++) {\r\n            expression = wrapFilter(expression, filters[i], context);\r\n        }\r\n        node.content = expression;\r\n    }\r\n}\r\nfunction wrapFilter(exp, filter, context) {\r\n    context.helper(RESOLVE_FILTER);\r\n    const i = filter.indexOf('(');\r\n    if (i < 0) {\r\n        context.filters.add(filter);\r\n        return `${toValidAssetId(filter, 'filter')}(${exp})`;\r\n    }\r\n    else {\r\n        const name = filter.slice(0, i);\r\n        const args = filter.slice(i + 1);\r\n        context.filters.add(name);\r\n        return `${toValidAssetId(name, 'filter')}(${exp}${args !== ')' ? ',' + args : args}`;\r\n    }\r\n}\r\n//# sourceMappingURL=transformFilter.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-core/src/runtimeHelpers.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-core/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-core/src/compat/compatConfig.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-core/src/ast.ts"],"map":"{\"version\":3,\"file\":\"transformFilter.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../packages/compiler-core/src/compat/transformFilter.ts\"],\"names\":[],\"mappings\":\"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\"}"}
