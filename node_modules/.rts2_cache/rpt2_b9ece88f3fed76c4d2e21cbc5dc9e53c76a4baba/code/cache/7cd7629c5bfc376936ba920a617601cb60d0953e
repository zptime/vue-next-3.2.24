{"code":"import { callWithErrorHandling } from '../errorHandling';\r\nimport { popWarningContext, pushWarningContext } from '../warning';\r\nimport { warnDeprecation, isCompatEnabled } from './compatConfig';\r\nexport const compatModelEventPrefix = `onModelCompat:`;\r\nconst warnedTypes = new WeakSet();\r\nexport function convertLegacyVModelProps(vnode) {\r\n    const { type, shapeFlag, props, dynamicProps } = vnode;\r\n    if (shapeFlag & 6 /* COMPONENT */ && props && 'modelValue' in props) {\r\n        if (!isCompatEnabled(\"COMPONENT_V_MODEL\" /* COMPONENT_V_MODEL */, \r\n        // this is a special case where we want to use the vnode component's\r\n        // compat config instead of the current rendering instance (which is the\r\n        // parent of the component that exposes v-model)\r\n        { type })) {\r\n            return;\r\n        }\r\n        if (__DEV__ && !warnedTypes.has(type)) {\r\n            pushWarningContext(vnode);\r\n            warnDeprecation(\"COMPONENT_V_MODEL\" /* COMPONENT_V_MODEL */, { type }, type);\r\n            popWarningContext();\r\n            warnedTypes.add(type);\r\n        }\r\n        // v3 compiled model code -> v2 compat props\r\n        // modelValue -> value\r\n        // onUpdate:modelValue -> onModelCompat:input\r\n        const { prop = 'value', event = 'input' } = type.model || {};\r\n        if (prop !== 'modelValue') {\r\n            props[prop] = props.modelValue;\r\n            delete props.modelValue;\r\n        }\r\n        // important: update dynamic props\r\n        if (dynamicProps) {\r\n            dynamicProps[dynamicProps.indexOf('modelValue')] = prop;\r\n        }\r\n        props[compatModelEventPrefix + event] = props['onUpdate:modelValue'];\r\n        delete props['onUpdate:modelValue'];\r\n    }\r\n}\r\nexport function compatModelEmit(instance, event, args) {\r\n    if (!isCompatEnabled(\"COMPONENT_V_MODEL\" /* COMPONENT_V_MODEL */, instance)) {\r\n        return;\r\n    }\r\n    const props = instance.vnode.props;\r\n    const modelHandler = props && props[compatModelEventPrefix + event];\r\n    if (modelHandler) {\r\n        callWithErrorHandling(modelHandler, instance, 6 /* COMPONENT_EVENT_HANDLER */, args);\r\n    }\r\n}\r\n//# sourceMappingURL=componentVModel.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/shared/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/component.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/errorHandling.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/vnode.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/warning.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/compat/compatConfig.ts"],"map":"{\"version\":3,\"file\":\"componentVModel.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../packages/runtime-core/src/compat/componentVModel.ts\"],\"names\":[],\"mappings\":\"AAEA,OAAO,EAAE,qBAAqB,EAAc,MAAM,kBAAkB,CAAA;AAEpE,OAAO,EAAE,iBAAiB,EAAE,kBAAkB,EAAE,MAAM,YAAY,CAAA;AAClE,OAAO,EAEL,eAAe,EACf,eAAe,EAChB,MAAM,gBAAgB,CAAA;AAEvB,MAAM,CAAC,MAAM,sBAAsB,GAAG,gBAAgB,CAAA;AAEtD,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAA;AAEjC,MAAM,UAAU,wBAAwB,CAAC,KAAY;IACnD,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE,YAAY,EAAE,GAAG,KAAK,CAAA;IACtD,IAAI,SAAS,oBAAuB,IAAI,KAAK,IAAI,YAAY,IAAI,KAAK,EAAE;QACtE,IACE,CAAC,eAAe;QAEd,oEAAoE;QACpE,wEAAwE;QACxE,gDAAgD;QAChD,EAAE,IAAI,EAAS,CAChB,EACD;YACA,OAAM;SACP;QAED,IAAI,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAwB,CAAC,EAAE;YACzD,kBAAkB,CAAC,KAAK,CAAC,CAAA;YACzB,eAAe,8CAAqC,EAAE,IAAI,EAAS,EAAE,IAAI,CAAC,CAAA;YAC1E,iBAAiB,EAAE,CAAA;YACnB,WAAW,CAAC,GAAG,CAAC,IAAwB,CAAC,CAAA;SAC1C;QAED,4CAA4C;QAC5C,sBAAsB;QACtB,6CAA6C;QAC7C,MAAM,EAAE,IAAI,GAAG,OAAO,EAAE,KAAK,GAAG,OAAO,EAAE,GAAI,IAAY,CAAC,KAAK,IAAI,EAAE,CAAA;QACrE,IAAI,IAAI,KAAK,YAAY,EAAE;YACzB,KAAK,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,UAAU,CAAA;YAC9B,OAAO,KAAK,CAAC,UAAU,CAAA;SACxB;QACD,kCAAkC;QAClC,IAAI,YAAY,EAAE;YAChB,YAAY,CAAC,YAAY,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,GAAG,IAAI,CAAA;SACxD;QACD,KAAK,CAAC,sBAAsB,GAAG,KAAK,CAAC,GAAG,KAAK,CAAC,qBAAqB,CAAC,CAAA;QACpE,OAAO,KAAK,CAAC,qBAAqB,CAAC,CAAA;KACpC;AACH,CAAC;AAED,MAAM,UAAU,eAAe,CAC7B,QAAmC,EACnC,KAAa,EACb,IAAW;IAEX,IAAI,CAAC,eAAe,8CAAqC,QAAQ,CAAC,EAAE;QAClE,OAAM;KACP;IACD,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAA;IAClC,MAAM,YAAY,GAAG,KAAK,IAAI,KAAK,CAAC,sBAAsB,GAAG,KAAK,CAAC,CAAA;IACnE,IAAI,YAAY,EAAE;QAChB,qBAAqB,CACnB,YAAY,EACZ,QAAQ,mCAER,IAAI,CACL,CAAA;KACF;AACH,CAAC\"}"}
