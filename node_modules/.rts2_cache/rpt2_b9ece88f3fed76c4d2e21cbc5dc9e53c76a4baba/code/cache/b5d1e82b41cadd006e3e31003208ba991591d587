{"code":"import { currentInstance } from './component';\r\nimport { normalizeVNode, InternalObjectKey } from './vnode';\r\nimport { isArray, isFunction, EMPTY_OBJ, extend, def } from '@vue/shared';\r\nimport { warn } from './warning';\r\nimport { isKeepAlive } from './components/KeepAlive';\r\nimport { withCtx } from './componentRenderContext';\r\nimport { isHmrUpdating } from './hmr';\r\nimport { isCompatEnabled } from './compat/compatConfig';\r\nimport { toRaw } from '@vue/reactivity';\r\nconst isInternalKey = (key) => key[0] === '_' || key === '$stable';\r\nconst normalizeSlotValue = (value) => isArray(value)\r\n    ? value.map(normalizeVNode)\r\n    : [normalizeVNode(value)];\r\nconst normalizeSlot = (key, rawSlot, ctx) => {\r\n    const normalized = withCtx((...args) => {\r\n        if (__DEV__ && currentInstance) {\r\n            warn(`Slot \"${key}\" invoked outside of the render function: ` +\r\n                `this will not track dependencies used in the slot. ` +\r\n                `Invoke the slot function inside the render function instead.`);\r\n        }\r\n        return normalizeSlotValue(rawSlot(...args));\r\n    }, ctx);\r\n    normalized._c = false;\r\n    return normalized;\r\n};\r\nconst normalizeObjectSlots = (rawSlots, slots, instance) => {\r\n    const ctx = rawSlots._ctx;\r\n    for (const key in rawSlots) {\r\n        if (isInternalKey(key))\r\n            continue;\r\n        const value = rawSlots[key];\r\n        if (isFunction(value)) {\r\n            slots[key] = normalizeSlot(key, value, ctx);\r\n        }\r\n        else if (value != null) {\r\n            if (__DEV__ &&\r\n                !(__COMPAT__ &&\r\n                    isCompatEnabled(\"RENDER_FUNCTION\" /* RENDER_FUNCTION */, instance))) {\r\n                warn(`Non-function value encountered for slot \"${key}\". ` +\r\n                    `Prefer function slots for better performance.`);\r\n            }\r\n            const normalized = normalizeSlotValue(value);\r\n            slots[key] = () => normalized;\r\n        }\r\n    }\r\n};\r\nconst normalizeVNodeSlots = (instance, children) => {\r\n    if (__DEV__ &&\r\n        !isKeepAlive(instance.vnode) &&\r\n        !(__COMPAT__ && isCompatEnabled(\"RENDER_FUNCTION\" /* RENDER_FUNCTION */, instance))) {\r\n        warn(`Non-function value encountered for default slot. ` +\r\n            `Prefer function slots for better performance.`);\r\n    }\r\n    const normalized = normalizeSlotValue(children);\r\n    instance.slots.default = () => normalized;\r\n};\r\nexport const initSlots = (instance, children) => {\r\n    if (instance.vnode.shapeFlag & 32 /* SLOTS_CHILDREN */) {\r\n        const type = children._;\r\n        if (type) {\r\n            // users can get the shallow readonly version of the slots object through `this.$slots`,\r\n            // we should avoid the proxy object polluting the slots of the internal instance\r\n            instance.slots = toRaw(children);\r\n            // make compiler marker non-enumerable\r\n            def(children, '_', type);\r\n        }\r\n        else {\r\n            normalizeObjectSlots(children, (instance.slots = {}), instance);\r\n        }\r\n    }\r\n    else {\r\n        instance.slots = {};\r\n        if (children) {\r\n            normalizeVNodeSlots(instance, children);\r\n        }\r\n    }\r\n    def(instance.slots, InternalObjectKey, 1);\r\n};\r\nexport const updateSlots = (instance, children, optimized) => {\r\n    const { vnode, slots } = instance;\r\n    let needDeletionCheck = true;\r\n    let deletionComparisonTarget = EMPTY_OBJ;\r\n    if (vnode.shapeFlag & 32 /* SLOTS_CHILDREN */) {\r\n        const type = children._;\r\n        if (type) {\r\n            // compiled slots.\r\n            if (__DEV__ && isHmrUpdating) {\r\n                // Parent was HMR updated so slot content may have changed.\r\n                // force update slots and mark instance for hmr as well\r\n                extend(slots, children);\r\n            }\r\n            else if (optimized && type === 1 /* STABLE */) {\r\n                // compiled AND stable.\r\n                // no need to update, and skip stale slots removal.\r\n                needDeletionCheck = false;\r\n            }\r\n            else {\r\n                // compiled but dynamic (v-if/v-for on slots) - update slots, but skip\r\n                // normalization.\r\n                extend(slots, children);\r\n                // #2893\r\n                // when rendering the optimized slots by manually written render function,\r\n                // we need to delete the `slots._` flag if necessary to make subsequent updates reliable,\r\n                // i.e. let the `renderSlot` create the bailed Fragment\r\n                if (!optimized && type === 1 /* STABLE */) {\r\n                    delete slots._;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            needDeletionCheck = !children.$stable;\r\n            normalizeObjectSlots(children, slots, instance);\r\n        }\r\n        deletionComparisonTarget = children;\r\n    }\r\n    else if (children) {\r\n        // non slot object children (direct value) passed to a component\r\n        normalizeVNodeSlots(instance, children);\r\n        deletionComparisonTarget = { default: 1 };\r\n    }\r\n    // delete stale slots\r\n    if (needDeletionCheck) {\r\n        for (const key in slots) {\r\n            if (!isInternalKey(key) && !(key in deletionComparisonTarget)) {\r\n                delete slots[key];\r\n            }\r\n        }\r\n    }\r\n};\r\n//# sourceMappingURL=componentSlots.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/component.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/vnode.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/shared/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/warning.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/components/KeepAlive.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/componentRenderContext.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/hmr.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/compat/compatConfig.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/index.ts"],"map":"{\"version\":3,\"file\":\"componentSlots.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/runtime-core/src/componentSlots.ts\"],\"names\":[],\"mappings\":\"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\"}"}
