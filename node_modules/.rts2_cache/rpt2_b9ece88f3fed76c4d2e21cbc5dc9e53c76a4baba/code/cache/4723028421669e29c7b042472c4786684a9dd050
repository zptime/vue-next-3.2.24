{"code":"import { createSimpleExpression, createObjectProperty, createCompoundExpression } from '../ast';\r\nimport { createCompilerError } from '../errors';\r\nimport { isMemberExpression, isSimpleIdentifier, hasScopeRef, isStaticExp } from '../utils';\r\nimport { IS_REF } from '../runtimeHelpers';\r\nexport const transformModel = (dir, node, context) => {\r\n    const { exp, arg } = dir;\r\n    if (!exp) {\r\n        context.onError(createCompilerError(41 /* X_V_MODEL_NO_EXPRESSION */, dir.loc));\r\n        return createTransformProps();\r\n    }\r\n    const rawExp = exp.loc.source;\r\n    const expString = exp.type === 4 /* SIMPLE_EXPRESSION */ ? exp.content : rawExp;\r\n    // im SFC <script setup> inline mode, the exp may have been transformed into\r\n    // _unref(exp)\r\n    const bindingType = context.bindingMetadata[rawExp];\r\n    const maybeRef = !__BROWSER__ &&\r\n        context.inline &&\r\n        bindingType &&\r\n        bindingType !== \"setup-const\" /* SETUP_CONST */;\r\n    if (!expString.trim() ||\r\n        (!isMemberExpression(expString, context) && !maybeRef)) {\r\n        context.onError(createCompilerError(42 /* X_V_MODEL_MALFORMED_EXPRESSION */, exp.loc));\r\n        return createTransformProps();\r\n    }\r\n    if (!__BROWSER__ &&\r\n        context.prefixIdentifiers &&\r\n        isSimpleIdentifier(expString) &&\r\n        context.identifiers[expString]) {\r\n        context.onError(createCompilerError(43 /* X_V_MODEL_ON_SCOPE_VARIABLE */, exp.loc));\r\n        return createTransformProps();\r\n    }\r\n    const propName = arg ? arg : createSimpleExpression('modelValue', true);\r\n    const eventName = arg\r\n        ? isStaticExp(arg)\r\n            ? `onUpdate:${arg.content}`\r\n            : createCompoundExpression(['\"onUpdate:\" + ', arg])\r\n        : `onUpdate:modelValue`;\r\n    let assignmentExp;\r\n    const eventArg = context.isTS ? `($event: any)` : `$event`;\r\n    if (maybeRef) {\r\n        if (bindingType === \"setup-ref\" /* SETUP_REF */) {\r\n            // v-model used on known ref.\r\n            assignmentExp = createCompoundExpression([\r\n                `${eventArg} => ((`,\r\n                createSimpleExpression(rawExp, false, exp.loc),\r\n                `).value = $event)`\r\n            ]);\r\n        }\r\n        else {\r\n            // v-model used on a potentially ref binding in <script setup> inline mode.\r\n            // the assignment needs to check whether the binding is actually a ref.\r\n            const altAssignment = bindingType === \"setup-let\" /* SETUP_LET */ ? `${rawExp} = $event` : `null`;\r\n            assignmentExp = createCompoundExpression([\r\n                `${eventArg} => (${context.helperString(IS_REF)}(${rawExp}) ? (`,\r\n                createSimpleExpression(rawExp, false, exp.loc),\r\n                `).value = $event : ${altAssignment})`\r\n            ]);\r\n        }\r\n    }\r\n    else {\r\n        assignmentExp = createCompoundExpression([\r\n            `${eventArg} => ((`,\r\n            exp,\r\n            `) = $event)`\r\n        ]);\r\n    }\r\n    const props = [\r\n        // modelValue: foo\r\n        createObjectProperty(propName, dir.exp),\r\n        // \"onUpdate:modelValue\": $event => (foo = $event)\r\n        createObjectProperty(eventName, assignmentExp)\r\n    ];\r\n    // cache v-model handler if applicable (when it doesn't refer any scope vars)\r\n    if (!__BROWSER__ &&\r\n        context.prefixIdentifiers &&\r\n        !context.inVOnce &&\r\n        context.cacheHandlers &&\r\n        !hasScopeRef(exp, context.identifiers)) {\r\n        props[1].value = context.cache(props[1].value);\r\n    }\r\n    // modelModifiers: { foo: true, \"bar-baz\": true }\r\n    if (dir.modifiers.length && node.tagType === 1 /* COMPONENT */) {\r\n        const modifiers = dir.modifiers\r\n            .map(m => (isSimpleIdentifier(m) ? m : JSON.stringify(m)) + `: true`)\r\n            .join(`, `);\r\n        const modifiersKey = arg\r\n            ? isStaticExp(arg)\r\n                ? `${arg.content}Modifiers`\r\n                : createCompoundExpression([arg, ' + \"Modifiers\"'])\r\n            : `modelModifiers`;\r\n        props.push(createObjectProperty(modifiersKey, createSimpleExpression(`{ ${modifiers} }`, false, dir.loc, 2 /* CAN_HOIST */)));\r\n    }\r\n    return createTransformProps(props);\r\n};\r\nfunction createTransformProps(props = []) {\r\n    return { props };\r\n}\r\n//# sourceMappingURL=vModel.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-core/src/transform.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-core/src/ast.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-core/src/errors.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-core/src/utils.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-core/src/runtimeHelpers.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/compiler-core/src/options.ts"],"map":"{\"version\":3,\"file\":\"vModel.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../packages/compiler-core/src/transforms/vModel.ts\"],\"names\":[],\"mappings\":\"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\"}"}
