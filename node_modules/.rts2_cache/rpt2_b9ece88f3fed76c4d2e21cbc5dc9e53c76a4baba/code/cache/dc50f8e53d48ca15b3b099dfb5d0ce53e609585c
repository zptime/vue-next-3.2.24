{"code":"import { createVNode, defineComponent, nextTick, warn } from '@vue/runtime-core';\r\nimport { camelize, extend, hyphenate, isArray, toNumber } from '@vue/shared';\r\nimport { hydrate, render } from '.';\r\nexport function defineCustomElement(options, hydate) {\r\n    const Comp = defineComponent(options);\r\n    class VueCustomElement extends VueElement {\r\n        constructor(initialProps) {\r\n            super(Comp, initialProps, hydate);\r\n        }\r\n    }\r\n    VueCustomElement.def = Comp;\r\n    return VueCustomElement;\r\n}\r\nexport const defineSSRCustomElement = ((options) => {\r\n    // @ts-ignore\r\n    return defineCustomElement(options, hydrate);\r\n});\r\nconst BaseClass = (typeof HTMLElement !== 'undefined' ? HTMLElement : class {\r\n});\r\nexport class VueElement extends BaseClass {\r\n    constructor(_def, _props = {}, hydrate) {\r\n        super();\r\n        this._def = _def;\r\n        this._props = _props;\r\n        /**\r\n         * @internal\r\n         */\r\n        this._instance = null;\r\n        this._connected = false;\r\n        this._resolved = false;\r\n        this._numberProps = null;\r\n        if (this.shadowRoot && hydrate) {\r\n            hydrate(this._createVNode(), this.shadowRoot);\r\n        }\r\n        else {\r\n            if (__DEV__ && this.shadowRoot) {\r\n                warn(`Custom element has pre-rendered declarative shadow root but is not ` +\r\n                    `defined as hydratable. Use \\`defineSSRCustomElement\\`.`);\r\n            }\r\n            this.attachShadow({ mode: 'open' });\r\n        }\r\n    }\r\n    connectedCallback() {\r\n        this._connected = true;\r\n        if (!this._instance) {\r\n            this._resolveDef();\r\n        }\r\n    }\r\n    disconnectedCallback() {\r\n        this._connected = false;\r\n        nextTick(() => {\r\n            if (!this._connected) {\r\n                render(null, this.shadowRoot);\r\n                this._instance = null;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * resolve inner component definition (handle possible async component)\r\n     */\r\n    _resolveDef() {\r\n        if (this._resolved) {\r\n            return;\r\n        }\r\n        this._resolved = true;\r\n        // set initial attrs\r\n        for (let i = 0; i < this.attributes.length; i++) {\r\n            this._setAttr(this.attributes[i].name);\r\n        }\r\n        // watch future attr changes\r\n        new MutationObserver(mutations => {\r\n            for (const m of mutations) {\r\n                this._setAttr(m.attributeName);\r\n            }\r\n        }).observe(this, { attributes: true });\r\n        const resolve = (def) => {\r\n            const { props, styles } = def;\r\n            const hasOptions = !isArray(props);\r\n            const rawKeys = props ? (hasOptions ? Object.keys(props) : props) : [];\r\n            // cast Number-type props set before resolve\r\n            let numberProps;\r\n            if (hasOptions) {\r\n                for (const key in this._props) {\r\n                    const opt = props[key];\r\n                    if (opt === Number || (opt && opt.type === Number)) {\r\n                        this._props[key] = toNumber(this._props[key]);\r\n                        (numberProps || (numberProps = Object.create(null)))[key] = true;\r\n                    }\r\n                }\r\n            }\r\n            this._numberProps = numberProps;\r\n            // check if there are props set pre-upgrade or connect\r\n            for (const key of Object.keys(this)) {\r\n                if (key[0] !== '_') {\r\n                    this._setProp(key, this[key], true, false);\r\n                }\r\n            }\r\n            // defining getter/setters on prototype\r\n            for (const key of rawKeys.map(camelize)) {\r\n                Object.defineProperty(this, key, {\r\n                    get() {\r\n                        return this._getProp(key);\r\n                    },\r\n                    set(val) {\r\n                        this._setProp(key, val);\r\n                    }\r\n                });\r\n            }\r\n            // apply CSS\r\n            this._applyStyles(styles);\r\n            // initial render\r\n            this._update();\r\n        };\r\n        const asyncDef = this._def.__asyncLoader;\r\n        if (asyncDef) {\r\n            asyncDef().then(resolve);\r\n        }\r\n        else {\r\n            resolve(this._def);\r\n        }\r\n    }\r\n    _setAttr(key) {\r\n        let value = this.getAttribute(key);\r\n        if (this._numberProps && this._numberProps[key]) {\r\n            value = toNumber(value);\r\n        }\r\n        this._setProp(camelize(key), value, false);\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    _getProp(key) {\r\n        return this._props[key];\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    _setProp(key, val, shouldReflect = true, shouldUpdate = true) {\r\n        if (val !== this._props[key]) {\r\n            this._props[key] = val;\r\n            if (shouldUpdate && this._instance) {\r\n                this._update();\r\n            }\r\n            // reflect\r\n            if (shouldReflect) {\r\n                if (val === true) {\r\n                    this.setAttribute(hyphenate(key), '');\r\n                }\r\n                else if (typeof val === 'string' || typeof val === 'number') {\r\n                    this.setAttribute(hyphenate(key), val + '');\r\n                }\r\n                else if (!val) {\r\n                    this.removeAttribute(hyphenate(key));\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _update() {\r\n        render(this._createVNode(), this.shadowRoot);\r\n    }\r\n    _createVNode() {\r\n        const vnode = createVNode(this._def, extend({}, this._props));\r\n        if (!this._instance) {\r\n            vnode.ce = instance => {\r\n                this._instance = instance;\r\n                instance.isCE = true;\r\n                // HMR\r\n                if (__DEV__) {\r\n                    instance.ceReload = newStyles => {\r\n                        // always reset styles\r\n                        if (this._styles) {\r\n                            this._styles.forEach(s => this.shadowRoot.removeChild(s));\r\n                            this._styles.length = 0;\r\n                        }\r\n                        this._applyStyles(newStyles);\r\n                        // if this is an async component, ceReload is called from the inner\r\n                        // component so no need to reload the async wrapper\r\n                        if (!this._def.__asyncLoader) {\r\n                            // reload\r\n                            this._instance = null;\r\n                            this._update();\r\n                        }\r\n                    };\r\n                }\r\n                // intercept emit\r\n                instance.emit = (event, ...args) => {\r\n                    this.dispatchEvent(new CustomEvent(event, {\r\n                        detail: args\r\n                    }));\r\n                };\r\n                // locate nearest Vue custom element parent for provide/inject\r\n                let parent = this;\r\n                while ((parent =\r\n                    parent && (parent.parentNode || parent.host))) {\r\n                    if (parent instanceof VueElement) {\r\n                        instance.parent = parent._instance;\r\n                        break;\r\n                    }\r\n                }\r\n            };\r\n        }\r\n        return vnode;\r\n    }\r\n    _applyStyles(styles) {\r\n        if (styles) {\r\n            styles.forEach(css => {\r\n                const s = document.createElement('style');\r\n                s.textContent = css;\r\n                this.shadowRoot.appendChild(s);\r\n                // record for HMR\r\n                if (__DEV__) {\r\n                    ;\r\n                    (this._styles || (this._styles = [])).push(s);\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=apiCustomElement.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/shared/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-dom/src/index.ts"],"map":"{\"version\":3,\"file\":\"apiCustomElement.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/runtime-dom/src/apiCustomElement.ts\"],\"names\":[],\"mappings\":\"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\"}"}
