{"code":"import { hyphenate, isArray } from '@vue/shared';\r\nimport { callWithAsyncErrorHandling } from '@vue/runtime-core';\r\n// Async edge case fix requires storing an event listener's attach timestamp.\r\nlet _getNow = Date.now;\r\nlet skipTimestampCheck = false;\r\nif (typeof window !== 'undefined') {\r\n    // Determine what event timestamp the browser is using. Annoyingly, the\r\n    // timestamp can either be hi-res (relative to page load) or low-res\r\n    // (relative to UNIX epoch), so in order to compare time we have to use the\r\n    // same timestamp type when saving the flush timestamp.\r\n    if (_getNow() > document.createEvent('Event').timeStamp) {\r\n        // if the low-res timestamp which is bigger than the event timestamp\r\n        // (which is evaluated AFTER) it means the event is using a hi-res timestamp,\r\n        // and we need to use the hi-res version for event listeners as well.\r\n        _getNow = () => performance.now();\r\n    }\r\n    // #3485: Firefox <= 53 has incorrect Event.timeStamp implementation\r\n    // and does not fire microtasks in between event propagation, so safe to exclude.\r\n    const ffMatch = navigator.userAgent.match(/firefox\\/(\\d+)/i);\r\n    skipTimestampCheck = !!(ffMatch && Number(ffMatch[1]) <= 53);\r\n}\r\n// To avoid the overhead of repeatedly calling performance.now(), we cache\r\n// and use the same timestamp for all event listeners attached in the same tick.\r\nlet cachedNow = 0;\r\nconst p = Promise.resolve();\r\nconst reset = () => {\r\n    cachedNow = 0;\r\n};\r\nconst getNow = () => cachedNow || (p.then(reset), (cachedNow = _getNow()));\r\nexport function addEventListener(el, event, handler, options) {\r\n    el.addEventListener(event, handler, options);\r\n}\r\nexport function removeEventListener(el, event, handler, options) {\r\n    el.removeEventListener(event, handler, options);\r\n}\r\nexport function patchEvent(el, rawName, prevValue, nextValue, instance = null) {\r\n    // vei = vue event invokers\r\n    const invokers = el._vei || (el._vei = {});\r\n    const existingInvoker = invokers[rawName];\r\n    if (nextValue && existingInvoker) {\r\n        // patch\r\n        existingInvoker.value = nextValue;\r\n    }\r\n    else {\r\n        const [name, options] = parseName(rawName);\r\n        if (nextValue) {\r\n            // add\r\n            const invoker = (invokers[rawName] = createInvoker(nextValue, instance));\r\n            addEventListener(el, name, invoker, options);\r\n        }\r\n        else if (existingInvoker) {\r\n            // remove\r\n            removeEventListener(el, name, existingInvoker, options);\r\n            invokers[rawName] = undefined;\r\n        }\r\n    }\r\n}\r\nconst optionsModifierRE = /(?:Once|Passive|Capture)$/;\r\nfunction parseName(name) {\r\n    let options;\r\n    if (optionsModifierRE.test(name)) {\r\n        options = {};\r\n        let m;\r\n        while ((m = name.match(optionsModifierRE))) {\r\n            name = name.slice(0, name.length - m[0].length);\r\n            options[m[0].toLowerCase()] = true;\r\n            options;\r\n        }\r\n    }\r\n    return [hyphenate(name.slice(2)), options];\r\n}\r\nfunction createInvoker(initialValue, instance) {\r\n    const invoker = (e) => {\r\n        // async edge case #6566: inner click event triggers patch, event handler\r\n        // attached to outer element during patch, and triggered again. This\r\n        // happens because browsers fire microtask ticks between event propagation.\r\n        // the solution is simple: we save the timestamp when a handler is attached,\r\n        // and the handler would only fire if the event passed to it was fired\r\n        // AFTER it was attached.\r\n        const timeStamp = e.timeStamp || _getNow();\r\n        if (skipTimestampCheck || timeStamp >= invoker.attached - 1) {\r\n            callWithAsyncErrorHandling(patchStopImmediatePropagation(e, invoker.value), instance, 5 /* NATIVE_EVENT_HANDLER */, [e]);\r\n        }\r\n    };\r\n    invoker.value = initialValue;\r\n    invoker.attached = getNow();\r\n    return invoker;\r\n}\r\nfunction patchStopImmediatePropagation(e, value) {\r\n    if (isArray(value)) {\r\n        const originalStop = e.stopImmediatePropagation;\r\n        e.stopImmediatePropagation = () => {\r\n            originalStop.call(e);\r\n            e._stopped = true;\r\n        };\r\n        return value.map(fn => (e) => !e._stopped && fn(e));\r\n    }\r\n    else {\r\n        return value;\r\n    }\r\n}\r\n//# sourceMappingURL=events.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/shared/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/errorHandling.ts"],"map":"{\"version\":3,\"file\":\"events.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../packages/runtime-dom/src/modules/events.ts\"],\"names\":[],\"mappings\":\"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\"}"}
