{"code":"import { warn } from './warning';\r\nlet activeEffectScope;\r\nconst effectScopeStack = [];\r\nexport class EffectScope {\r\n    constructor(detached = false) {\r\n        this.active = true;\r\n        this.effects = [];\r\n        this.cleanups = [];\r\n        if (!detached && activeEffectScope) {\r\n            this.parent = activeEffectScope;\r\n            this.index =\r\n                (activeEffectScope.scopes || (activeEffectScope.scopes = [])).push(this) - 1;\r\n        }\r\n    }\r\n    run(fn) {\r\n        if (this.active) {\r\n            try {\r\n                this.on();\r\n                return fn();\r\n            }\r\n            finally {\r\n                this.off();\r\n            }\r\n        }\r\n        else if (__DEV__) {\r\n            warn(`cannot run an inactive effect scope.`);\r\n        }\r\n    }\r\n    on() {\r\n        if (this.active) {\r\n            effectScopeStack.push(this);\r\n            activeEffectScope = this;\r\n        }\r\n    }\r\n    off() {\r\n        if (this.active) {\r\n            effectScopeStack.pop();\r\n            activeEffectScope = effectScopeStack[effectScopeStack.length - 1];\r\n        }\r\n    }\r\n    stop(fromParent) {\r\n        if (this.active) {\r\n            this.effects.forEach(e => e.stop());\r\n            this.cleanups.forEach(cleanup => cleanup());\r\n            if (this.scopes) {\r\n                this.scopes.forEach(e => e.stop(true));\r\n            }\r\n            // nested scope, dereference from parent to avoid memory leaks\r\n            if (this.parent && !fromParent) {\r\n                // optimized O(1) removal\r\n                const last = this.parent.scopes.pop();\r\n                if (last && last !== this) {\r\n                    this.parent.scopes[this.index] = last;\r\n                    last.index = this.index;\r\n                }\r\n            }\r\n            this.active = false;\r\n        }\r\n    }\r\n}\r\nexport function effectScope(detached) {\r\n    return new EffectScope(detached);\r\n}\r\nexport function recordEffectScope(effect, scope) {\r\n    scope = scope || activeEffectScope;\r\n    if (scope && scope.active) {\r\n        scope.effects.push(effect);\r\n    }\r\n}\r\nexport function getCurrentScope() {\r\n    return activeEffectScope;\r\n}\r\nexport function onScopeDispose(fn) {\r\n    if (activeEffectScope) {\r\n        activeEffectScope.cleanups.push(fn);\r\n    }\r\n    else if (__DEV__) {\r\n        warn(`onScopeDispose() is called when there is no active effect scope` +\r\n            ` to be associated with.`);\r\n    }\r\n}\r\n//# sourceMappingURL=effectScope.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/effect.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/warning.ts"],"map":"{\"version\":3,\"file\":\"effectScope.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/reactivity/src/effectScope.ts\"],\"names\":[],\"mappings\":\"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\"}"}
