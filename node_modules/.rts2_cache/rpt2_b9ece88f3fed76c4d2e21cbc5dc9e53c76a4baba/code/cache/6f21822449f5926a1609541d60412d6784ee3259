{"code":"import { getCurrentInstance } from '../component';\r\nimport { resolveInjections } from '../componentOptions';\r\nimport { getCompatListeners } from './instanceListeners';\r\nimport { compatH } from './renderFn';\r\nconst normalizedFunctionalComponentMap = new Map();\r\nexport const legacySlotProxyHandlers = {\r\n    get(target, key) {\r\n        const slot = target[key];\r\n        return slot && slot();\r\n    }\r\n};\r\nexport function convertLegacyFunctionalComponent(comp) {\r\n    if (normalizedFunctionalComponentMap.has(comp)) {\r\n        return normalizedFunctionalComponentMap.get(comp);\r\n    }\r\n    const legacyFn = comp.render;\r\n    const Func = (props, ctx) => {\r\n        const instance = getCurrentInstance();\r\n        const legacyCtx = {\r\n            props,\r\n            children: instance.vnode.children || [],\r\n            data: instance.vnode.props || {},\r\n            scopedSlots: ctx.slots,\r\n            parent: instance.parent && instance.parent.proxy,\r\n            slots() {\r\n                return new Proxy(ctx.slots, legacySlotProxyHandlers);\r\n            },\r\n            get listeners() {\r\n                return getCompatListeners(instance);\r\n            },\r\n            get injections() {\r\n                if (comp.inject) {\r\n                    const injections = {};\r\n                    resolveInjections(comp.inject, injections);\r\n                    return injections;\r\n                }\r\n                return {};\r\n            }\r\n        };\r\n        return legacyFn(compatH, legacyCtx);\r\n    };\r\n    Func.props = comp.props;\r\n    Func.displayName = comp.name;\r\n    Func.compatConfig = comp.compatConfig;\r\n    // v2 functional components do not inherit attrs\r\n    Func.inheritAttrs = false;\r\n    normalizedFunctionalComponentMap.set(comp, Func);\r\n    return Func;\r\n}\r\n//# sourceMappingURL=componentFunctional.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/component.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/componentOptions.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/componentSlots.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/compat/instanceListeners.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/runtime-core/src/compat/renderFn.ts"],"map":"{\"version\":3,\"file\":\"componentFunctional.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../packages/runtime-core/src/compat/componentFunctional.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAGL,kBAAkB,EACnB,MAAM,cAAc,CAAA;AACrB,OAAO,EAAE,iBAAiB,EAAE,MAAM,qBAAqB,CAAA;AAEvD,OAAO,EAAE,kBAAkB,EAAE,MAAM,qBAAqB,CAAA;AACxD,OAAO,EAAE,OAAO,EAAE,MAAM,YAAY,CAAA;AAEpC,MAAM,gCAAgC,GAAG,IAAI,GAAG,EAG7C,CAAA;AAEH,MAAM,CAAC,MAAM,uBAAuB,GAAgC;IAClE,GAAG,CAAC,MAAM,EAAE,GAAW;QACrB,MAAM,IAAI,GAAG,MAAM,CAAC,GAAG,CAAC,CAAA;QACxB,OAAO,IAAI,IAAI,IAAI,EAAE,CAAA;IACvB,CAAC;CACF,CAAA;AAED,MAAM,UAAU,gCAAgC,CAAC,IAAsB;IACrE,IAAI,gCAAgC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;QAC9C,OAAO,gCAAgC,CAAC,GAAG,CAAC,IAAI,CAAE,CAAA;KACnD;IAED,MAAM,QAAQ,GAAG,IAAI,CAAC,MAAa,CAAA;IAEnC,MAAM,IAAI,GAAwB,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;QAC/C,MAAM,QAAQ,GAAG,kBAAkB,EAAG,CAAA;QAEtC,MAAM,SAAS,GAAG;YAChB,KAAK;YACL,QAAQ,EAAE,QAAQ,CAAC,KAAK,CAAC,QAAQ,IAAI,EAAE;YACvC,IAAI,EAAE,QAAQ,CAAC,KAAK,CAAC,KAAK,IAAI,EAAE;YAChC,WAAW,EAAE,GAAG,CAAC,KAAK;YACtB,MAAM,EAAE,QAAQ,CAAC,MAAM,IAAI,QAAQ,CAAC,MAAM,CAAC,KAAK;YAChD,KAAK;gBACH,OAAO,IAAI,KAAK,CAAC,GAAG,CAAC,KAAK,EAAE,uBAAuB,CAAC,CAAA;YACtD,CAAC;YACD,IAAI,SAAS;gBACX,OAAO,kBAAkB,CAAC,QAAQ,CAAC,CAAA;YACrC,CAAC;YACD,IAAI,UAAU;gBACZ,IAAI,IAAI,CAAC,MAAM,EAAE;oBACf,MAAM,UAAU,GAAG,EAAE,CAAA;oBACrB,iBAAiB,CAAC,IAAI,CAAC,MAAM,EAAE,UAAU,CAAC,CAAA;oBAC1C,OAAO,UAAU,CAAA;iBAClB;gBACD,OAAO,EAAE,CAAA;YACX,CAAC;SACF,CAAA;QACD,OAAO,QAAQ,CAAC,OAAO,EAAE,SAAS,CAAC,CAAA;IACrC,CAAC,CAAA;IACD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAA;IACvB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAA;IAC5B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAA;IACrC,gDAAgD;IAChD,IAAI,CAAC,YAAY,GAAG,KAAK,CAAA;IAEzB,gCAAgC,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;IAChD,OAAO,IAAI,CAAA;AACb,CAAC\"}"}
