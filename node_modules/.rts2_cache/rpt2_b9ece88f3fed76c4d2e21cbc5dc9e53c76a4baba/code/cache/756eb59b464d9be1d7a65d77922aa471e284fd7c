{"code":"import { isTracking, trackEffects, triggerEffects } from './effect';\r\nimport { isArray, hasChanged } from '@vue/shared';\r\nimport { isProxy, toRaw, isReactive, toReactive } from './reactive';\r\nimport { createDep } from './dep';\r\nexport function trackRefValue(ref) {\r\n    if (isTracking()) {\r\n        ref = toRaw(ref);\r\n        if (!ref.dep) {\r\n            ref.dep = createDep();\r\n        }\r\n        if (__DEV__) {\r\n            trackEffects(ref.dep, {\r\n                target: ref,\r\n                type: \"get\" /* GET */,\r\n                key: 'value'\r\n            });\r\n        }\r\n        else {\r\n            trackEffects(ref.dep);\r\n        }\r\n    }\r\n}\r\nexport function triggerRefValue(ref, newVal) {\r\n    ref = toRaw(ref);\r\n    if (ref.dep) {\r\n        if (__DEV__) {\r\n            triggerEffects(ref.dep, {\r\n                target: ref,\r\n                type: \"set\" /* SET */,\r\n                key: 'value',\r\n                newValue: newVal\r\n            });\r\n        }\r\n        else {\r\n            triggerEffects(ref.dep);\r\n        }\r\n    }\r\n}\r\nexport function isRef(r) {\r\n    return Boolean(r && r.__v_isRef === true);\r\n}\r\nexport function ref(value) {\r\n    return createRef(value, false);\r\n}\r\nexport function shallowRef(value) {\r\n    return createRef(value, true);\r\n}\r\nfunction createRef(rawValue, shallow) {\r\n    if (isRef(rawValue)) {\r\n        return rawValue;\r\n    }\r\n    return new RefImpl(rawValue, shallow);\r\n}\r\nclass RefImpl {\r\n    constructor(value, _shallow) {\r\n        this._shallow = _shallow;\r\n        this.dep = undefined;\r\n        this.__v_isRef = true;\r\n        this._rawValue = _shallow ? value : toRaw(value);\r\n        this._value = _shallow ? value : toReactive(value);\r\n    }\r\n    get value() {\r\n        trackRefValue(this);\r\n        return this._value;\r\n    }\r\n    set value(newVal) {\r\n        newVal = this._shallow ? newVal : toRaw(newVal);\r\n        if (hasChanged(newVal, this._rawValue)) {\r\n            this._rawValue = newVal;\r\n            this._value = this._shallow ? newVal : toReactive(newVal);\r\n            triggerRefValue(this, newVal);\r\n        }\r\n    }\r\n}\r\nexport function triggerRef(ref) {\r\n    triggerRefValue(ref, __DEV__ ? ref.value : void 0);\r\n}\r\nexport function unref(ref) {\r\n    return isRef(ref) ? ref.value : ref;\r\n}\r\nconst shallowUnwrapHandlers = {\r\n    get: (target, key, receiver) => unref(Reflect.get(target, key, receiver)),\r\n    set: (target, key, value, receiver) => {\r\n        const oldValue = target[key];\r\n        if (isRef(oldValue) && !isRef(value)) {\r\n            oldValue.value = value;\r\n            return true;\r\n        }\r\n        else {\r\n            return Reflect.set(target, key, value, receiver);\r\n        }\r\n    }\r\n};\r\nexport function proxyRefs(objectWithRefs) {\r\n    return isReactive(objectWithRefs)\r\n        ? objectWithRefs\r\n        : new Proxy(objectWithRefs, shallowUnwrapHandlers);\r\n}\r\nclass CustomRefImpl {\r\n    constructor(factory) {\r\n        this.dep = undefined;\r\n        this.__v_isRef = true;\r\n        const { get, set } = factory(() => trackRefValue(this), () => triggerRefValue(this));\r\n        this._get = get;\r\n        this._set = set;\r\n    }\r\n    get value() {\r\n        return this._get();\r\n    }\r\n    set value(newVal) {\r\n        this._set(newVal);\r\n    }\r\n}\r\nexport function customRef(factory) {\r\n    return new CustomRefImpl(factory);\r\n}\r\nexport function toRefs(object) {\r\n    if (__DEV__ && !isProxy(object)) {\r\n        console.warn(`toRefs() expects a reactive object but received a plain one.`);\r\n    }\r\n    const ret = isArray(object) ? new Array(object.length) : {};\r\n    for (const key in object) {\r\n        ret[key] = toRef(object, key);\r\n    }\r\n    return ret;\r\n}\r\nclass ObjectRefImpl {\r\n    constructor(_object, _key) {\r\n        this._object = _object;\r\n        this._key = _key;\r\n        this.__v_isRef = true;\r\n    }\r\n    get value() {\r\n        return this._object[this._key];\r\n    }\r\n    set value(newVal) {\r\n        this._object[this._key] = newVal;\r\n    }\r\n}\r\nexport function toRef(object, key) {\r\n    const val = object[key];\r\n    return isRef(val) ? val : new ObjectRefImpl(object, key);\r\n}\r\n//# sourceMappingURL=ref.js.map","references":["/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/effect.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/operations.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/shared/src/index.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/reactive.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/reactive.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/collectionHandlers.ts","/Users/zhangpian/Documents/projects/github/vue-next-3.2.24/packages/reactivity/src/dep.ts"],"map":"{\"version\":3,\"file\":\"ref.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/reactivity/src/ref.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,UAAU,EAAE,YAAY,EAAE,cAAc,EAAE,MAAM,UAAU,CAAA;AAEnE,OAAO,EAAE,OAAO,EAAE,UAAU,EAAE,MAAM,aAAa,CAAA;AACjD,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,UAAU,EAAE,UAAU,EAAE,MAAM,YAAY,CAAA;AAGnE,OAAO,EAAE,SAAS,EAAO,MAAM,OAAO,CAAA;AAuBtC,MAAM,UAAU,aAAa,CAAC,GAAiB;IAC7C,IAAI,UAAU,EAAE,EAAE;QAChB,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,CAAA;QAChB,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE;YACZ,GAAG,CAAC,GAAG,GAAG,SAAS,EAAE,CAAA;SACtB;QACD,IAAI,OAAO,EAAE;YACX,YAAY,CAAC,GAAG,CAAC,GAAG,EAAE;gBACpB,MAAM,EAAE,GAAG;gBACX,IAAI,iBAAkB;gBACtB,GAAG,EAAE,OAAO;aACb,CAAC,CAAA;SACH;aAAM;YACL,YAAY,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;SACtB;KACF;AACH,CAAC;AAED,MAAM,UAAU,eAAe,CAAC,GAAiB,EAAE,MAAY;IAC7D,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,CAAA;IAChB,IAAI,GAAG,CAAC,GAAG,EAAE;QACX,IAAI,OAAO,EAAE;YACX,cAAc,CAAC,GAAG,CAAC,GAAG,EAAE;gBACtB,MAAM,EAAE,GAAG;gBACX,IAAI,iBAAoB;gBACxB,GAAG,EAAE,OAAO;gBACZ,QAAQ,EAAE,MAAM;aACjB,CAAC,CAAA;SACH;aAAM;YACL,cAAc,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;SACxB;KACF;AACH,CAAC;AAGD,MAAM,UAAU,KAAK,CAAC,CAAM;IAC1B,OAAO,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,SAAS,KAAK,IAAI,CAAC,CAAA;AAC3C,CAAC;AAOD,MAAM,UAAU,GAAG,CAAC,KAAe;IACjC,OAAO,SAAS,CAAC,KAAK,EAAE,KAAK,CAAC,CAAA;AAChC,CAAC;AAWD,MAAM,UAAU,UAAU,CAAC,KAAe;IACxC,OAAO,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;AAC/B,CAAC;AAED,SAAS,SAAS,CAAC,QAAiB,EAAE,OAAgB;IACpD,IAAI,KAAK,CAAC,QAAQ,CAAC,EAAE;QACnB,OAAO,QAAQ,CAAA;KAChB;IACD,OAAO,IAAI,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAA;AACvC,CAAC;AAED,MAAM,OAAO;IAOX,YAAY,KAAQ,EAAkB,QAAiB;QAAjB,aAAQ,GAAR,QAAQ,CAAS;QAHhD,QAAG,GAAS,SAAS,CAAA;QACZ,cAAS,GAAG,IAAI,CAAA;QAG9B,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAA;QAChD,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,UAAU,CAAC,KAAK,CAAC,CAAA;IACpD,CAAC;IAED,IAAI,KAAK;QACP,aAAa,CAAC,IAAI,CAAC,CAAA;QACnB,OAAO,IAAI,CAAC,MAAM,CAAA;IACpB,CAAC;IAED,IAAI,KAAK,CAAC,MAAM;QACd,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAA;QAC/C,IAAI,UAAU,CAAC,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE;YACtC,IAAI,CAAC,SAAS,GAAG,MAAM,CAAA;YACvB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,CAAA;YACzD,eAAe,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA;SAC9B;IACH,CAAC;CACF;AAED,MAAM,UAAU,UAAU,CAAC,GAAQ;IACjC,eAAe,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAA;AACpD,CAAC;AAED,MAAM,UAAU,KAAK,CAAI,GAAe;IACtC,OAAO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAE,GAAG,CAAC,KAAa,CAAC,CAAC,CAAC,GAAG,CAAA;AAC9C,CAAC;AAED,MAAM,qBAAqB,GAAsB;IAC/C,GAAG,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;IACzE,GAAG,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,EAAE,EAAE;QACpC,MAAM,QAAQ,GAAG,MAAM,CAAC,GAAG,CAAC,CAAA;QAC5B,IAAI,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE;YACpC,QAAQ,CAAC,KAAK,GAAG,KAAK,CAAA;YACtB,OAAO,IAAI,CAAA;SACZ;aAAM;YACL,OAAO,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAA;SACjD;IACH,CAAC;CACF,CAAA;AAED,MAAM,UAAU,SAAS,CACvB,cAAiB;IAEjB,OAAO,UAAU,CAAC,cAAc,CAAC;QAC/B,CAAC,CAAC,cAAc;QAChB,CAAC,CAAC,IAAI,KAAK,CAAC,cAAc,EAAE,qBAAqB,CAAC,CAAA;AACtD,CAAC;AAUD,MAAM,aAAa;IAQjB,YAAY,OAA4B;QAPjC,QAAG,GAAS,SAAS,CAAA;QAKZ,cAAS,GAAG,IAAI,CAAA;QAG9B,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,OAAO,CAC1B,GAAG,EAAE,CAAC,aAAa,CAAC,IAAI,CAAC,EACzB,GAAG,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAC5B,CAAA;QACD,IAAI,CAAC,IAAI,GAAG,GAAG,CAAA;QACf,IAAI,CAAC,IAAI,GAAG,GAAG,CAAA;IACjB,CAAC;IAED,IAAI,KAAK;QACP,OAAO,IAAI,CAAC,IAAI,EAAE,CAAA;IACpB,CAAC;IAED,IAAI,KAAK,CAAC,MAAM;QACd,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;IACnB,CAAC;CACF;AAED,MAAM,UAAU,SAAS,CAAI,OAA4B;IACvD,OAAO,IAAI,aAAa,CAAC,OAAO,CAAQ,CAAA;AAC1C,CAAC;AAKD,MAAM,UAAU,MAAM,CAAmB,MAAS;IAChD,IAAI,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;QAC/B,OAAO,CAAC,IAAI,CAAC,8DAA8D,CAAC,CAAA;KAC7E;IACD,MAAM,GAAG,GAAQ,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAA;IAChE,KAAK,MAAM,GAAG,IAAI,MAAM,EAAE;QACxB,GAAG,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,GAAG,CAAC,CAAA;KAC9B;IACD,OAAO,GAAG,CAAA;AACZ,CAAC;AAED,MAAM,aAAa;IAGjB,YAA6B,OAAU,EAAmB,IAAO;QAApC,YAAO,GAAP,OAAO,CAAG;QAAmB,SAAI,GAAJ,IAAI,CAAG;QAFjD,cAAS,GAAG,IAAI,CAAA;IAEoC,CAAC;IAErE,IAAI,KAAK;QACP,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;IAChC,CAAC;IAED,IAAI,KAAK,CAAC,MAAM;QACd,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,MAAM,CAAA;IAClC,CAAC;CACF;AAID,MAAM,UAAU,KAAK,CACnB,MAAS,EACT,GAAM;IAEN,MAAM,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAA;IACvB,OAAO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAE,IAAI,aAAa,CAAC,MAAM,EAAE,GAAG,CAAS,CAAA;AACnE,CAAC\"}"}
